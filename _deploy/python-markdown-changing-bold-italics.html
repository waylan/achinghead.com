<!DOCTYPE html> 
<html lang="en"> 
 
<head> 
  <meta charset="utf-8" /> 
  <title>achinghead.com &ndash; Python-Markdown Tutorial Part 2: Changing Bold and Italics</title> 
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--> 
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
  <script src="/media/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="/media/style.css" /> 
  <link rel="stylesheet" href="/media/highlight.css">
  <link rel="alternate" type="application/atom+xml" title="achinghead.com feed" href="/atom.xml" /> 
  <link rel="shortcut icon" href="/favicon.ico" /> 
</head> 
 
<body> 
 
  <header id='siteheader'> 
 
    <hgroup> 
      <h1>achinghead.com</h1> 
      <h2>about to explode with half-baked ideas</h2> 
    </hgroup> 
 
    <nav> 
      <ul> 
        <li><a href="index.html">home</a></li> 
        <li><a href="archive.html">archive</a></li> 
        <li><a href="projects.html">projects</a></li> 
        <li><a href="about.html">about</a></li> 
      </ul> 
    </nav> 
 
  </header> 


  <article> 
    <header> 
      <hgroup>
        <h1> 
          <a href="python-markdown-changing-bold-italics.html" rel="bookmark" title="link to this post">Python-Markdown Tutorial Part 2: Changing Bold and Italics</a> 
        </h1> 
        <h2>by Waylan Limberg <time datetime="2009-07-12" pubdate>July 12, 2009</time></h2>
      <hgroup>
    </header> 
 
<p>In <a href="/python-markdown-adding-insert-delete.html">part 1</a>, we created a Python-Markdown extension which implements a new 
syntax for defining <code>&lt;ins&gt;</code> and <code>&lt;del&gt;</code> tags. Now we need to alter Markdown's 
existing syntax for bold and italics. As a reminder, your new syntax should 
look like this:</p>
<pre><code class="no-highlight">Two hyphens for --delete--.
Two underscores for <strong>insert</strong>.
Two asterisks for <strong>strong</strong>.
Two slashes for //emphasis//.</code></pre>
<p>First, we need to define our new regular expressions. We can just use the same
expressions from last time with a few modifications.</p>
<pre><code class="language-python">STRONG_RE = r'(**)(.<em>?)**'
EMPH_RE = r'(\/\/)(.</em>?)\/\/'</code></pre>
<p>Now we need to insert these into the markdown parser. However, unlike with ins and del, we need to override the existing inline patterns. A quick look at the
<a href="http://gitorious.org/python-markdown/mainline/blobs/master/markdown/__init__.py#line276">source</a> indicates that strong and emphasis are currently implemented with 
four inline patterns; "strong", "emphasis", "emphasis2" and "strong_em".</p>
<p>Let's override "strong" first.</p>
<pre><code class="language-python">class MyExtension(markdown.Extension):
    def extendMarkdown(self, md, md_globals):
        ...
        # Create new strong pattern
        strong_tag = markdown.inlinepatterns.SimpleTagPattern(STRONG_RE, 'strong')
        # Override existing strong pattern
        md.inlinepatterns['strong'] = strong_tag
</code></pre>
<p>Notice that rather than "add"ing a new pattern before or after an existing 
pattern, we simple reassigned the value of a pattern named "strong". This is
because the old pattern named "strong" already existed and we don't need to 
change its location in the parser. So we simply assign a new pattern instance 
to it.</p>
<p>We can do the same for emphasis:</p>
<pre><code class="language-python">class MyExtension(markdown.Extension):
    def extendMarkdown(self, md, md_globals):
        ...
        emph_tag = markdown.inlinepatterns.SimpleTagPattern(EMPH_RE, 'emphasis')
        md.inlinepatterns['emphasis'] = emph_tag
</code></pre>
<p>Now we have two old patterns left, "strong_em" and "emphasis2". "Emphasis2"
was just a special case so that underscored_words were not mistaken for 
emphasis, but as our new syntax required double underscores, it's not needed any
more. Therefore, we can delete it. The same applies for strong_em. With the old 
syntax, due to both strong and emphasis using the same characters, a special 
case was needed to match the two nested together (i.e.: <code>***like this***</code>). 
Again this isn't needed. We can delete the two in the same way we would delete 
dict items:</p>
<pre><code class="language-python">class MyExtension(markdown.Extension):
    def extendMarkdown(self, md, md_globals):
        ...
        del md.inlinepatterns['strong_em']
        del md.inlinepatterns['emphasis2']
</code></pre>
<p>That should do it. For completeness, the entire extension should look like this:</p>
<pre><code class="language-python">import markdown

DEL_RE = r'(--)(.<em>?)--'
INS_RE = r'(__)(.</em>?)__'
STRONG_RE = r'(**)(.<em>?)**'
EMPH_RE = r'(\/\/)(.</em>?)\/\/'

class MyExtension(markdown.Extension):
    def extendMarkdown(self, md, md_globals):
        del_tag = markdown.inlinepatterns.SimpleTagPattern(DEL_RE, 'del')
        md.inlinepatterns.add('del', del_tag, '&gt;not_strong')
        ins_tag = markdown.inlinepatterns.SimpleTagPattern(INS_RE, 'ins')
        md.inlinepatterns.add('ins', ins_tag, '&gt;del')
        strong_tag = markdown.inlinepatterns.SimpleTagPattern(STRONG_RE, 'strong')
        md.inlinepatterns['strong'] = strong_tag
        emph_tag = markdown.inlinepatterns.SimpleTagPattern(EMPH_RE, 'emphasis')
        md.inlinepatterns['emphasis'] = emph_tag
        del md.inlinepatterns['strong_em']
        del md.inlinepatterns['emphasis2']

def makeExtension(configs=None):
    return MyExtension(configs=configs)</code></pre>
<p>In part 3 (coming soon) we'll combine all four of those patterns into one new
pattern. Yes, that means we'll be writing our own InlinePattern class.</p>

  </article>

  <footer> 
 
    <p>&copy; 2010 <a href="about.html">Waylan Limberg</a></p> 
 
  </footer> 
 
</body> 
</html> 