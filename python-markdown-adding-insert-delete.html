<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Python-Markdown Tutorial Part 1: Adding InlinePatterns Insert and Delete - achinghead.com</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://achinghead.com/python-markdown-adding-insert-delete.html">

        <meta name="author" content="Waylan Limberg" />
        <meta name="keywords" content="markdown,python" />
        <meta name="description" content="A tutorial which steps through creating a simple Python-Markdown Extension which slightly alters the Markdown syntax. Specifically, we add an inline syntax for &lt;ins&gt; and &lt;del&gt;." />

    <!-- Enable latex plugin -->




    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://achinghead.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://achinghead.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://achinghead.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://achinghead.com/theme/css/style.css" type="text/css"/>

        <link href="http://achinghead.com/atom.xml" type="application/atom+xml" rel="alternate"
              title="achinghead.com ATOM Feed"/>



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://achinghead.com/" class="navbar-brand">
achinghead.com            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://achinghead.com/pages/about.html">
                             About
                          </a></li>
                         <li><a href="http://achinghead.com/pages/projects.html">
                             Projects
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://achinghead.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://achinghead.com/python-markdown-adding-insert-delete.html"
                       rel="bookmark"
                       title="Permalink to Python-Markdown Tutorial Part 1: Adding InlinePatterns Insert and Delete">
                        Python-Markdown Tutorial Part 1: Adding InlinePatterns Insert and Delete
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2009-06-24T00:00:00-04:00"> June 24, 2009</time>
    </span>






<span class="label label-default">Tags</span>
	<a href="http://achinghead.com/tag/markdown.html">markdown</a>
        /
	<a href="http://achinghead.com/tag/python.html">python</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>A <a href="http://six.pairlist.net/pipermail/markdown-discuss/2009-June/001591.html">recent question</a> on the <a href="http://six.pairlist.net/mailman/listinfo/markdown-discuss">markdown-discuss</a> mailing list resulted in some
suggestions for an extension to <a href="http://www.freewisdom.org/projects/python-markdown/">Python-Markdown</a>. I was able to point Simon
to the <a href="http://www.freewisdom.org/projects/python-markdown/Writing_Extensions">documentation</a> for writing extensions, but it occurs to me that that 
document could be a little overwhelming for a first-timer. Especially when all
he needs is to alter the behavior of a few inline patterns.</p>
<p>So, without further ado, I present a tutorial which steps through creating a
Python-Markdown Extension which incorporates something similar to Simon&rsquo;s
suggestion.</p>
<p>First, we need to establish the syntax we will be implementing. While Simon&rsquo;s 
suggestion would work as is, I&rsquo;m more inclined to implement a slight variation
which follows the <a href="http://txt2tags.sourceforge.net/userguide/BoldItalicUnderlineStrike.html#6_5">prior art</a> of the <a href="http://txt2tags.sourceforge.net/index.html">txt2tags</a> project. Interestingly, the
<a href="http://www.wikicreole.org/">CREOLE</a> project more-or-less adopted this same syntax and has an interesting 
<a href="http://www.wikicreole.org/wiki/BoldAndItalicsReasoning">explanation</a> of the reasoning behind their community based decision. While I
may not agree with all their reasoning, I do like the idea that in each instance
double characters are used for markup. That way, there&rsquo;s less chance of a single
character needing to be escaped - both for the machine and human reader. So, the
syntax looks like this:</p>
<div class="highlight"><pre>Two hyphens for --strike--.
Two underscores for __underline__.
Two asterisks for **bold**.
Two slashes for //italic//.
</pre></div>


<p>The first step is to create the boilerplate code that will be required by any
Python-Markdown Extension.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">markdown</span>

<span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">md_globals</span><span class="p">):</span>
        <span class="c"># Insert code here to change markdown&#39;s behavior.</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">makeExtension</span><span class="p">(</span><span class="n">configs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">MyExtension</span><span class="p">(</span><span class="n">configs</span><span class="o">=</span><span class="n">configs</span><span class="p">)</span>
</pre></div>


<p>Save the above code as <code>mdx_myextension.py</code>. Now, obviously, that code doesn&rsquo;t
really do anything useful, but now that we have it in place, we can actually 
start implementing our new syntax.</p>
<p>To start, let&rsquo;s implement the one part of that syntax that doesn&rsquo;t overlap with
Markdown&rsquo;s standard syntax; the <code>--strike--</code> syntax. I&rsquo;m actually going to call 
it &ldquo;del&rdquo; (delete) rather than &ldquo;strike&rdquo; as the html generated will be the <code>&lt;del&gt;</code>
tag.</p>
<p>The first step is to write a regular expression to match the del syntax.</p>
<div class="highlight"><pre><span class="n">DEL_RE</span> <span class="o">=</span> <span class="s">r&#39;(--)(.*?)--&#39;</span>
</pre></div>


<p>Now, there are probably a few things I should explain about that. First, you may
note that the first set of hyphens (<code>(--)</code>) are grouped in parentheses. This is 
because we will be using a generic pattern class provided by Python-Markdown.
Specifically, the <code>SimpleTextPattern</code> which expects the text content to be found
in <code>group(3)</code> of the regular expression. As the entire text (including markup)
will be in <code>group(1)</code>, we add the extra group to force the content we want into
<code>group(3)</code>.</p>
<p>Second, you may want to note that the content is matched using a non-greedy 
match <code>(.*?)</code>. Otherwise, everything between the first occurrence and the last 
would all be placed inside one <code>&lt;del&gt;</code> tag, which we do not want.</p>
<p>So, let&rsquo;s incorporate our regular expression into Markdown:</p>
<div class="highlight"><pre><span class="n">DEL_RE</span> <span class="o">=</span> <span class="s">r&#39;(--)(.*?)--&#39;</span>

<span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">md_globals</span><span class="p">):</span>
        <span class="c"># Create the del pattern</span>
        <span class="n">del_tag</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">inlinepatterns</span><span class="o">.</span><span class="n">SimpleTagPattern</span><span class="p">(</span><span class="n">DEL_RE</span><span class="p">,</span> <span class="s">&#39;del&#39;</span><span class="p">)</span>
        <span class="c"># Insert del pattern into markdown parser</span>
        <span class="n">md</span><span class="o">.</span><span class="n">inlinepatterns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="n">del_tag</span><span class="p">,</span> <span class="s">&#39;&gt;not_strong&#39;</span><span class="p">)</span>
</pre></div>


<p>If you noticed, we added two lines. The first line creates an instance of a
<code>SimpleTagPattern</code>. This generic pattern class takes two arguments; the 
regular expression to match against (in this case <code>DEL_RE</code>), and the name of 
the tag to insert the text of <code>group(3)</code> into (&ldquo;del&rdquo;).</p>
<p>The second line adds our new pattern to the Markdown parser. In the event that 
it is not obvious, the <code>extendMarkdown</code> method of any <code>markdown.Extension</code> class is passed two arguments; &ldquo;md&rdquo; and &ldquo;md_globals&rdquo;. &ldquo;md&rdquo; is actually the instance
of the Markdown class. This allows you to alter anything you want in the class
from your extension. In this case, we are adding a new inline pattern named 
&ldquo;del&rdquo;, using our pattern instance <code>del_tag</code> after the pattern named 
&ldquo;not_strong&rdquo; (thus the <code>'&gt;not_strong'</code>).</p>
<p>Now let&rsquo;s test our new extension. Open a python interpreter in the same 
directory as you saved your file (&ldquo;mdx_myextension.py&rdquo;) and try the following:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">markdown</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s">&#39;foo --deleted-- bar&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;myextension&#39;</span><span class="p">])</span>
<span class="s">u&#39;&lt;p&gt;foo &lt;del&gt;deleted&lt;/del&gt; bar&lt;/p&gt;&#39;</span>
</pre></div>


<p>Notice that we passed in &ldquo;myextension&rdquo; as an extension name. Markdown 
automatically appended &ldquo;mdx_&rdquo; to the name and tried to import it. As long as
the file is on your PYTHONPATH, Markdown will find it and load the extension.</p>
<p>Let&rsquo;s add our syntax for underline, or as I&rsquo;m referring to it <code>__ins__</code> for the <code>&lt;ins&gt;</code> tag.</p>
<div class="highlight"><pre><span class="n">DEL_RE</span> <span class="o">=</span> <span class="s">r&#39;(--)(.*?)--&#39;</span>
<span class="n">INS_RE</span> <span class="o">=</span> <span class="s">r&#39;(__)(.*?)__&#39;</span>

<span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">md_globals</span><span class="p">):</span>
        <span class="n">del_tag</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">inlinepatterns</span><span class="o">.</span><span class="n">SimpleTagPattern</span><span class="p">(</span><span class="n">DEL_RE</span><span class="p">,</span> <span class="s">&#39;del&#39;</span><span class="p">)</span>
        <span class="n">md</span><span class="o">.</span><span class="n">inlinepatterns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="n">del_tag</span><span class="p">,</span> <span class="s">&#39;&gt;not_strong&#39;</span><span class="p">)</span>
        <span class="n">ins_tag</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">inlinepatterns</span><span class="o">.</span><span class="n">SimpleTagPattern</span><span class="p">(</span><span class="n">INS_RE</span><span class="p">,</span> <span class="s">&#39;ins&#39;</span><span class="p">)</span>
        <span class="n">md</span><span class="o">.</span><span class="n">inlinepatterns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;ins&#39;</span><span class="p">,</span> <span class="n">ins_tag</span><span class="p">,</span> <span class="s">&#39;&gt;del&#39;</span><span class="p">)</span>
</pre></div>


<p>That should be self explanatory. We simply created a new pattern which matches
our &ldquo;ins&rdquo; syntax and added it after the &ldquo;del&rdquo; pattern. What&rsquo;s interesting about 
this is that we do not even need to alter the existing bold syntax (<code>__bold__</code>)
as our pattern has been inserted into the parser before the existing bold 
pattern (named &ldquo;strong&rdquo;). Therefore, by the time that the &ldquo;strong&rdquo; pattern gets
to run, our extension has already identified the double underscores as inserts,
so there&rsquo;s no match against the &ldquo;strong&rdquo; pattern.</p>
<p>Therefore, if all we wanted to implement was ins and del syntax we are done - 
well, except maybe giving it a decent name. Go ahead and test it out. That 
being the case, we&rsquo;ll stop here, and pick up with <a href="/python-markdown-changing-bold-italics.html">Part 2</a> <del>(coming soon)</del> where
we implement the new bold and italic syntax which replaces Markdown&rsquo;s 
existing syntax.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">



                <li class="list-group-item"><a href="http://achinghead.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://achinghead.com/tag/python.html">
                                python
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://achinghead.com/tag/markdown.html">
                                markdown
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/ubuntu.html">
                                Ubuntu
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/virtualbox.html">
                                VirtualBox
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/django.html">
                                django
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/linux.html">
                                linux
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/prostetics.html">
                                prostetics
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/bicycles.html">
                                bicycles
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/html.html">
                                html
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/syntax-highlighting.html">
                                syntax highlighting
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/clipless-glove.html">
                                Clipless Glove
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/python-nose.html">
                                Python Nose
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/automobile.html">
                                automobile
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/electronics.html">
                                electronics
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/css.html">
                                css
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/anti-spam.html">
                                anti-spam
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/hardware.html">
                                hardware
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/hacks.html">
                                hacks
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/git.html">
                                git
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/testing.html">
                                testing
                            </a>
                        </li>
                    </ul>
                </li>    



        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Waylan Limberg
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://achinghead.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://achinghead.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://achinghead.com/theme/js/respond.min.js"></script>

</body>
</html>