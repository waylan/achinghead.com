<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Adding WikiLinks to Markdown in Python - achinghead.com</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://achinghead.com/adding-wikilinks-to-markdown-in-python.html">

        <meta name="author" content="Waylan Limberg" />
        <meta name="keywords" content="markdown,python" />
        <meta name="description" content="I needed Markdown to be extended to support wikilinks. It just so happens that the markdown lib for python makes this easy. After only a little head scratching I was able to come up with the followingâ€¦" />

    <!-- Enable latex plugin -->




    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://achinghead.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://achinghead.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://achinghead.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://achinghead.com/theme/css/style.css" type="text/css"/>

        <link href="http://achinghead.com/atom.xml" type="application/atom+xml" rel="alternate"
              title="achinghead.com ATOM Feed"/>



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://achinghead.com/" class="navbar-brand">
achinghead.com            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://achinghead.com/pages/about.html">
                             About
                          </a></li>
                         <li><a href="http://achinghead.com/pages/projects.html">
                             Projects
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://achinghead.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://achinghead.com/adding-wikilinks-to-markdown-in-python.html"
                       rel="bookmark"
                       title="Permalink to Adding WikiLinks to Markdown in Python">
                        Adding WikiLinks to Markdown in Python
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2006-01-15T00:00:00-05:00"> January 15, 2006</time>
    </span>






<span class="label label-default">Tags</span>
	<a href="http://achinghead.com/tag/markdown.html">markdown</a>
        /
	<a href="http://achinghead.com/tag/python.html">python</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><strong>Update:</strong> For the latest on this see the <a href="http://achinghead.com/markdown/wikilink/">page</a> I created.</p>
<p>I&rsquo;ve been playing with <a href='http://www.djangoproject.com/'>Django</a> lately and really like it. I&rsquo;ve wanted to create some sort of paging system where I can create new pages and easily edit their content. Basically a cross between a wiki and Wordpress pages. Django seemed like the easiest way for me to do this. Add to that, I really prefer <a href='http://daringfireball.net/projects/markdown/syntax'>Markdown syntax</a> to any other such markup language.</p>
<p>It was with this in mind that I took a look at <a href='http://e-scribe.com/news/'>Paul Bissex</a>&lsquo;s <a href='http://e-scribe.com/news/171'>wikiproject</a>. The basics are certainly there. And with little effort, I was able to get Markdown, along with the basic wikilinks working. The problem was that the wikilink code had no way of knowing to skip over various parts of the Markdown syntax. That means that Markdown needs to be extended to support wikilinks. It just so happens that the <a href='http://www.freewisdom.org/projects/python-markdown/'>markdown lib for python</a> makes this easy. After only a little head scratching I was able to come up with the following code:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">markdown</span>

<span class="k">class</span> <span class="nc">WikiLinks</span> <span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">BasePattern</span><span class="p">)</span> <span class="p">:</span>
  <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">WIKI_URL</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;/&#39;</span>
    <span class="n">WIKI_LABEL</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">WIKI_LABEL</span><span class="p">))</span>
    <span class="n">a</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="n">WIKI_URL</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">,</span> <span class="s">&#39;wikilink&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="k">def</span> <span class="nf">wikiMarkdown</span> <span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">:</span>
  <span class="n">WIKILINK_RE</span> <span class="o">=</span> <span class="s">r&#39;\b(([A-Z]+[a-z]+){2,})\b&#39;</span>
  <span class="n">md</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">Markdown</span><span class="p">()</span>
  <span class="n">md</span><span class="o">.</span><span class="n">inlinePatterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WikiLinks</span><span class="p">(</span><span class="n">WIKILINK_RE</span><span class="p">))</span>
  <span class="n">md</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">text</span>
  <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>I should note that the above code is in no way connected to Django. It should be easily adapted to work for any python project. It is also possible that the URL and LABEL would need to be further manipulated for your projects needs. This shouldn&rsquo;t be to difficult either. But let&rsquo;s get the basics working first. So, how about a quick test?:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="sb">``</span><span class="err">`</span><span class="n">Some</span> <span class="n">text</span> <span class="k">with</span> <span class="n">a</span> <span class="n">WikiLink</span><span class="o">.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="n">And</span> <span class="n">a</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="sb">`http://example.com/RealLink`</span><span class="o">&gt;</span><span class="n">RealLink</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="n">And</span> <span class="n">a</span> <span class="p">[</span><span class="n">MarkdownLink</span><span class="p">](</span><span class="o">/</span><span class="n">MarkdownLink</span><span class="o">/</span> <span class="s">&quot;A MarkdownLink&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">completeness</span><span class="o">.</span><span class="sb">``</span><span class="err">`</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">wikiMarkdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="go">&lt;p&gt;Some text with a &lt;a href=&quot;/WikiLink/&quot; class=&quot;wikilink&quot;&gt;WikiLink&lt;/a&gt;.</span>
<span class="go">&lt;/p&gt;</span>
<span class="go">&lt;p&gt;And a &lt;a href=`http://example.com/RealLink`&gt; &lt;a href=&quot;/RealLink/&quot; class=&quot;wikilink&quot;&gt;RealLink&lt;/a&gt; &lt;/a&gt;.</span>
<span class="go">&lt;/p&gt;</span>
<span class="go">&lt;p&gt;And a &lt;a href=&quot;/MarkdownLink/&quot; title=&quot;A MarkdownLink&quot;&gt;MarkdownLink&lt;/a&gt; for completeness.</span>
<span class="go">&lt;/p&gt;</span>
</pre></div>


<p>Now, my understanding is that markdown is supposed to leave HTML alone. However, that doesn&rsquo;t quite happen here as evidenced by the &ldquo;RealLink&rdquo;. Whether this is a problem with my code or a bug in python&rsquo;s markdown  lib I don&rsquo;t know. Either way, I did a bunch more tests, but this seems to be the only problem I could find. That, and I need a way to escape CamelCase words that I do not want WikiLinked (like PhD&hellip;). In the end, I decided that in reality, I would rather explicitly mark each link as such and never have to worry about inadvertent links sneaking into my text. With markdown, creating links is easy enough, and with Markdown&rsquo;s referenced links, the text is plenty easy to read as source. So, in the end, I have decided to not use the above code. That being said, someone else may find it useful.</p>
<p>If you would like to use my code, consider it licensed the same as Markdown in Python (dual-licensed under <a href='http://www.gnu.org/copyleft/gpl.html'>GPL</a> and <a href='http://www.opensource.org/licenses/bsd-license.php'>BSD License</a> - no, I didn&rsquo;t really put much thought into that). You can download the source as <a href='/code/wikiMarkdown.py'>wikiMarkdown.py</a>. Copy the file to a directory in your PYTHONPATH and do the following (assuming you have Markdown in Python installed and working):</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wikiMarkdown</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wm</span> <span class="o">=</span> <span class="n">wikiMarkdown</span><span class="p">(</span><span class="n">YOURTEXTSOURCE</span><span class="p">)</span>
</pre></div>


<p>Happy wikilinking with Markdown!</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">



                <li class="list-group-item"><a href="http://achinghead.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://achinghead.com/tag/python.html">
                                python
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://achinghead.com/tag/markdown.html">
                                markdown
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/ubuntu.html">
                                Ubuntu
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/virtualbox.html">
                                VirtualBox
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/django.html">
                                django
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://achinghead.com/tag/linux.html">
                                linux
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/prostetics.html">
                                prostetics
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/bicycles.html">
                                bicycles
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/html.html">
                                html
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/syntax-highlighting.html">
                                syntax highlighting
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://achinghead.com/tag/clipless-glove.html">
                                Clipless Glove
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/python-nose.html">
                                Python Nose
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/automobile.html">
                                automobile
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/electronics.html">
                                electronics
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/css.html">
                                css
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/anti-spam.html">
                                anti-spam
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/hardware.html">
                                hardware
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/hacks.html">
                                hacks
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/git.html">
                                git
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://achinghead.com/tag/testing.html">
                                testing
                            </a>
                        </li>
                    </ul>
                </li>    



        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Waylan Limberg
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://achinghead.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://achinghead.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://achinghead.com/theme/js/respond.min.js"></script>

</body>
</html>